# 문자열 덧셈 계산기 (javascript-calculator-precourse)


## 💡 왜 구현을 해야 하는가
이 과제의 핵심은 **문자열 형태로 입력된 숫자 데이터를 처리하는 법**을 연습하는 것임. 

보통 계산기는 숫자를 입력받아 계산한다고 생각함.  
과제를 풀기 전, **“어떤 경우에 이런 계산이 필요한지”** 궁금했음.

조사 결과, 실제 개발 환경에서 대부분의 외부 입력(사용자 입력, API, 파일 등)은  **문자열(String)** 형태로 전달되며, 이를 안전하게 **숫자로 변환하고 검증하는 과정**이 필요함.


## 💳 문제와 가장 비슷하다고 생각한 사례 - 계좌번호
예를 들어, 사용자가 `"110-234-567890"` 같은 **계좌번호**를 입력하면 시스템은 하이픈(`-`)을 제거하고 숫자만 남긴 뒤  
**유효성 검증** 등을 수행함.  
(출처: [Talkpal - 숫자에 대한 문자열](https://talkpal.ai/ko/grammar/%EC%88%AB%EC%9E%90%EC%97%90-%EB%8C%80%ED%95%9C-%EB%AC%B8%EC%9E%90%EC%97%B4/))

이처럼 입력은 **문자열로 들어오지만**,  실제 처리는 **숫자로 변환된 데이터**를 기반으로 이루어지는 경우가 있음.  따라서 문자열 덧셈 계산기는 이런 실제 상황을 단순화한 형태로  문자열 데이터를 **안전하게 파싱하고 계산하는 과정**을 연습하기 위한 과제라고 생각하며 진행함.

---

## ✅ 구현 체크리스트 (기능 단위)

### 1️.입력 처리
1. [x] 사용자에게 문자열을 입력받는다. 
(→ @woowacourse/mission-utils의 Console.readLineAsync()로 사용자 입력 처리.→ 입력 안내 문구 출력 및 입력값 출력으로 흐름 확인.)

2. [x] 입력이 **빈 문자열(`""`)**이면 `0`을 반환한다.  
  - 예: `"" → 0`
  (->trim()`으로 앞뒤 공백을 제거해 빈 입력 여부를 판단.)

### 2️.구분자 처리
1. - [x] **기본 구분자** `,`(쉼표), `:`(콜론)으로 분리한다.
(-> 쉼표(,)와 콜론(:)을 정규식 /[, :]/로 분리하여 토큰 배열 생성.)

2. - [x] **커스텀 구분자**가 있을 경우 `"//"`와 `"\n"` 사이의 **한 글자**를 구분자로 인식한다.  
(-> 정규식 /^\/\/(.)\s*(?:\r?\n|\\n)([\s\S]*)$/를 사용해 CRLF(\r\n) 및 리터럴 \n 모두 처리)

3. - [x] 커스텀 구분자가 있을 때만 위 규칙을 적용하고, 없으면 기본 구분자를 사용한다.

4. - [x] 구분자 사이에 값이 비어 있는 **잘못된 형식**(예: `"1,,2"`, `"//;\n1;;2"`)은 예외 처리한다.
(->split 결과의 빈 문자열을 검사하여 형식 오류 감지)

### 3.숫자 추출 및 검증
1. - [x] 분리된 토큰을 **정수로 변환**한다.
(->문자열로 분리된 각 토큰을 `Number.parseInt()`를 사용해 정수로 변환함.)

2. - [x] **양수만 허용**한다. (음수 불가)
(->Number.parseInt() 변환 후 num < 0 조건으로 음수 검증 추가)

3. - [x] 숫자가 아닌 값이 포함되면 예외 발생 
(->정규식 /^-?\\d+$/로 문자열이 순수 숫자인지 검증하도록 개선)


4. - [x] 변환할 수 없는 값(빈 문자열 등)이 있으면 예외 발생  (->기본 구분자 정규식을 `/[, :]/` → `/[,:]/` 로 변경하여 공백(` `)을 데이터로 인식하도록 수정.)

### 4.덧셈 계산
1. - [x] 검증된 **정수 배열의 합**을 계산한다.  
2. - [x] 계산 결과를 반환한다.
(->`parser.js`에서 입력 문자열을 토큰화하고, 각 값을 **정수로 변환 및 검증**하여 `add.js`로 전달-> `add.js`에서는 전달받은 **정수 배열(numbers)**을 `reduce()`를 사용해 합산.)


### 5.결과 출력
1. - [x] 계산 결과를 다음 형식으로 출력한다. 결과 : 6
2. - [x] 예외 발생 시 메시지는 **반드시 `[ERROR]`로 시작**한다.  
(-> 최종 예외 처리 목록 확인 완료)

---

## 🚨 예외 처리 목록

- [x] 1. 빈 구분자(연속된 구분자)  
   - 예: "1,,2", "//;\n1;;2"  
   - [ERROR] 잘못된 구분자 형식입니다.

- [x] 2. 음수 입력  
   - 예: "1,-2,3"  
   - [ERROR] 음수는 허용되지 않습니다.

- [x] 3. 숫자가 아닌 문자 포함  
   - 예: "1,a,3"  
   - [ERROR] 숫자만 입력 가능합니다.

- [x] 4. 변환 불가능한 값 포함  
   - 예: "1, ,3", "//;\n1;\n2"  
   - [ERROR] 변환할 수 없는 값이 있습니다.

   - 💡 헷갈린 부분 -> 공백은 데이터로 존재하므로 오류,
아무것도 없으면 입력이 없으므로 0.

- [x] 5. 커스텀 구분자 형식 오류  
   - 예: "//\n1;2"  
   - [ERROR] 커스텀 구분자 형식이 올바르지 않습니다.

---

## 추가 오류 발견 
### 숫자 사이 공백 입력시 오류 발생
1. 입력값 `"2 2"`에서 `[ERROR] 숫자만 입력 가능합니다.`가 발생함.  
   이는 숫자 검증 정규식(`/^-?\d+$/`)이 숫자 사이의 공백을 허용하지 않았기 때문임.  

2. 숫자 사이에 공백이 포함된 경우를 감지하는 정규식(`/\d\s+\d/`)을 추가함으로,  
   구분자(`,` 또는 `:`) 누락 상황을 명확히 구분할 수 있도록 개선함.  

3. 이제 `"2 2"` 입력 시  
   `[ERROR] 숫자 사이에 공백이 있습니다.`  
   메시지가 출력되어 사용자 피드백이 더욱 직관적으로 개선됨.


## 코드 개선 고민
코드는 완성했으나, 처음에 **주민등록번호나 계좌번호처럼 “문자열 형태로 전달된 숫자를 얼마나 안전하게 다룰 수 있을까”**에서 출발했던 만큼 코드의 안정성을 더 높이는 방법에 대해 고민하게 되었음.  

```
MDN Web Docs의 parseInt() 문서 확인 결과, 자바스크립트의 Number 타입은 **정밀도를 2⁵³−1 (≈9,007,199,254,740,991)**까지만 보장함. 


이를 초과한 정수 연산은 부동소수점 오차로 인해 정확한 결과를 낼 수 없음.

따라서 큰 수 연산에서는 Number.isSafeInteger()를 통해 검증하거나, 필요하면 BigInt를 써야 함.
(출처-https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt)
```

이 내용을 바탕으로 add.js를 다음과 같이 개선했음.

### add.js 개선 내용
```
1. reduce() 대신 for...of문을 사용해 매 연산마다 안전 정수 범위를 검사하도록 바꿨음.

2. Number.isSafeInteger()로 누적값(acc)과 현재값(n), 그리고 합(acc + n)을 모두 확인하도록 함.
→ 안전 범위를 벗어나면 [ERROR] 안전한 정수 범위를 초과했습니다. 예외를 던지도록 했음.

3. 이 검사를 통해, 2⁵³−1을 초과하는 큰 수 연산에서 발생할 수 있는 정밀도 손실 문제를 사전에 차단했음.
```